## 设计模式六大原则-里式替换原则

## 一、定义
这项原则最早是由麻省理工学院的一位女士（Barbara Liskov） 提出来的。

* 定义1:如果对每一个类型为 T1 的对象o1，都有类型为 T2 的对象o2，使得以 T1 定义的所有程序 P 在所有的对象 o1 都代换成 o2 时，程序 P 的行为没有发生变化，那么类型 T2 是类型 T1 的子类型（继承关系）。

* 定义2：**所有引用基类的地方必须能透明地使用其子类的对象**。

    或者说**继承必须确保超类所拥有的性质在子类中依然成立。**

    简单说就是**父类能出现的地方也可以替换为子类(最终还是调用父类的方法)。**使用者可能根本不知道是父类还是子类。但是反过来就不行，有子类出现的地方，父类不一定能使用。

**里式替换原则主要阐述了有关继承的一些原则，就是什么时候应该使用继承，什么时候不应该使用继承，以及其中蕴含的原理。**

## 二、问题由来
最有名的是"正方形不是长方形"。

几维鸟和燕子都是鸟，但是几维鸟不能飞，所以不能继承“飞”的功能，即不能定义成“鸟”的子类。

![96A8-E05D5F4479D4.png](https://pic.imgdb.cn/item/62b87f382f2591908882d288.png)
几维鸟的速度被设置为0，导致计算几维鸟的飞行时间报错(分母为0)。

## 三、解决方案
![86FB57DDF457.png](https://pic.imgdb.cn/item/62b8805a2f259190888453e3.png)

## 四、作用
* 里式替换原则是实现开闭原则的重要方式之一。
* 它克服了继承中重写父类造成的可复用性变差的缺点。
* 它是动作正确性的保证，即类的扩展不会给已有的系统引入新的错误，降低了代码出错的可能性。
* 加强程序的健壮性，同时变更时可以做到非常好的兼容性，提供程序的维护性、可扩展性、降低需求变更引入的风险。

## 五、举例说明
* 详见wiki: https://www.jianshu.com/p/46b670abf709

## 六、示例分析
有的时候在子类中去写一个方法的时候，给方法起名的时候无意中重写了父类的方法，造成所有运行相减功能的代码全部调用了类 B 重写后的方法，造成原本运行正常的功能出现了错误。

在实际编程中，**我们常常会通过重写父类的方法来完成新的功能，这样写起来虽然简单，但是整个继承体系的可复用性会比较差，特别是运用多态比较频繁时，程序运行出错的几率非常大。**

如果非要重写父类的方法，比较通用的做法是：**原来的父类和子类都继承一个更通俗的基类，原有的继承关系去掉，采用依赖、聚合、组合等关系代替。**

## 五、最佳实践

采用里式替换原则时，尽量避免子类的”个性“。

## 六、总结

如果不遵循里式替换原则，程序可能也会好好的，但是在之后的迭代过程中，代码出问题的几率会大大增加。

里式替换原则通俗来讲就是：
**子类可以扩展父类的功能，但不能改变父类原有的功能。------重点**

它包含以下 4 层含义：
### 1、**子类可以实现父类的抽象方法，但不能重写(覆盖)父类的非抽象方法**
因为当把父类方法替换为子类时，子类方法逻辑可能有问题不适合。

继承包含这样一层含义：父类中凡是已经实现好的方法（非抽象方法），实际上是设定一系列的规范和契约，虽然它不强制要求所有的子类必须遵守这些契约，但是如果子类对这些非抽象方法任意修改，就会对整个继承体系造成破坏。

### 2、**子类中可以增加自己特有的方法**

### 3、当子类的方法重载父类的方法时，方法的前置条件（即方法的形参）要比父类方法的输入参数更宽松或者相同

![47cd0da5f6f736181c.jpeg](https://pic.imgdb.cn/item/62b921e11d64b0706683e46c.jpg)

最直接的一个目的就是防止我们将父类对象替换为子类对象后，造成方法调用混乱的问题。

![377505adab0f49369ad5.png](https://pic.imgdb.cn/item/62b922421d64b07066845485.png)

这时候都会调用父类的方法。

如果父子类中的传参类型调换下，我们本意是希望对象替换后还执行原来的方法的，可结果却发生变化了调用到子类的方法。

### 4、当子类的方法实现父类的抽象方法时，方法的后置条件（即方法的返回值）要比父类更严格 

![9d83.jpeg](https://pic.imgdb.cn/item/62b945ca1d64b07066b475cf.jpg)

如果我们试图在子类中放大，重写或实现来自父类方法的返回值时，代码会报错，连基本的编译器都无法通过。


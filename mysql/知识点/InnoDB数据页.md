## Innodb数据页
页是InnoDB管理存储空间的基本单位，一个页的大小一般是16KB。InnoDB为了不同的目的设计了许多不同类型的页，我们这里主要关注存储数据记录的页，官方称为索引页/数据页。

Buffer Pool 中存的就是一页一页的数据。再比如，当我们要查询的数据不在 Buffer Pool 中时，InnoDB 会将记录所在的页整个加载到 Buffer Pool 中去；同样的，将 Buffer Pool 中的脏页刷入磁盘时，也是按照页为单位刷入磁盘的。

页与页之间是通过一个双向链表连接起来。
![20220122121649.jpg](https://pic.imgdb.cn/item/61eb85392ab3f51d91a63154.jpg)

而存储在页中的一行一行的数据则是通过单链表连接起来的。指针指向的不是物理上的下一个，而是逻辑上的下一个。
![20220122122928.jpg](https://pic.imgdb.cn/item/61eb886f2ab3f51d91a8fd3b.jpg)

## 一、数据页结构
![v2-435dcbdb6d19260524d5bfe4b757c0bd_r.jpeg](https://pic.imgdb.cn/item/61eb6cdd2ab3f51d918dea3e.jpg)

一个InnoDB数据页被划分为了7个部分，下面大概描述一下这7个部分内容。

![20220122104419.jpg](https://pic.imgdb.cn/item/61eb6f8b2ab3f51d919092c0.jpg)

大致存储结果是这样
![20220122171945.jpg](https://pic.imgdb.cn/item/61ebcc3d2ab3f51d91f48d5f.jpg)

### 1、Page Directory（页目录）- 槽
记录在页中按照主键大小正序串联成了一个单链表。如果我们要根据主键查找具体的某条记录应该怎么办，简单的方式是根据链表进行遍历。但是在数据量比较大的情况下，这种方式显然效率太差了。因此mysql使用了Page Directory（页目录）来解决这个问题。**页目录其实是页内的数据目录**。

大致的原理如下：

* 将所有正常的记录（包括最大和最小记录，不包括标记为已删除的记录）划分为几个组。怎么划分先不关注。
* 每个组的最后一条记录（也就是组内最大的那条记录）的头信息中的n_owned属性表示该组内共有几条记录。
* 将每个组的最后一条记录的地址偏移量单独提取出来按顺序存储到靠近页尾部的地方，这个地方就是所谓的Page Directory。

mysql规定对于最小记录所在的分组只能有 1 条记录，最大记录所在的分组拥有的记录条数只能在 1-8 条之间，剩下的分组中记录的条数范围只能在是 4-8 条之间。比方说现在的page_demo表中正常的记录共有18条，InnoDB会把它们分成5组，第一组中只有一个最小记录，如下所示：
![20220122104813.jpg](https://pic.imgdb.cn/item/61eb70752ab3f51d91918e2f.jpg)

通过Page Directory在一个数据页中查找指定主键值的记录的过程分为两步：
* 通过二分法确定该记录所在的槽，并找到该槽所在分组中主键值最小的那条记录。
* 通过记录的next_record属性遍历该槽所在的组中的各个记录。

流程图
![v2-e05540fdf24e219137cd744ad4645bd8_1440w.jpeg](https://pic.imgdb.cn/item/61eb888f2ab3f51d91a91a65.png)

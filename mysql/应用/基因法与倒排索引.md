## 基因法与倒排索引

## 一、场景
按照uid hash算法分库，如果按照username查询数据时，该怎么办？

## 二、方案
### 1、基因法
新增用户时，通过用户名决定’分库基因‘。

步骤(假如有4个数据库，则取两位)
* md5(username),换成数字后取最后两位，比如01=1，即该条数据在1号数据库。
* uid前缀+2位基因，比如uid为64位，则uid=uid前缀+2位。

优点
* 简单，不需要额外查询便可快捷分表查询

缺点
* 建议2(1)/4(2)/8/(3)数据库节点，提前规划，不具备迁移条件
* 主键生成器算法要求更高，如62+2全局唯一。
* 只能有一个非主键字段与主键对应。

使用场景
* 在关键字段上使用。

### 2、倒排索引法-二级索引法
维护一个redis，key为username，value是uid,{节点号}。

优点
* 简单，最通用的分库分表检索方案，几乎适用于所有系统

缺点
* 多一次查询，性能有所降低。
* 控制不好数据量爆炸，对redis内存需求量大(如果SSD性能好，也可以使用mysql表存储)
* 需要手动维护数据库和缓存间的一致性。







## Redis删除策略
数据删除策略的目标：在内存占用与CPU占用之间寻找一种平衡，顾此失彼都会造成整体redis性能的下降，甚至引发服务器宕机或内存泄漏。

## 一、删除分类
### 1 定时删除
在设置某个key 的过期时间同时，**为每个设置过期时间的key都创造一个定时器**；当key过期时间到达时，由定时器任务立即执行对键的删除操作；

* 优点：节约内存，到时就删除，快速释放掉不必要的内存占用
* 缺点：CPU压力很大，无论CPU此时负载量多高，均占用CPU，会影响redis服务器响应时间和指令吞吐量。

> 总结：用处理器性能换空间。

注：Redis服务器没有使用定时删除这种策略；

### 2 惰性删除-内置功能

所谓惰性策略就是在客户端访问这个key的时候，redis对key的过期时间进行检查，如果过期了就立即删除，不会给你返回任何东西。

定期删除可能会导致很多过期key到了时间并没有被删除掉。所以就有了惰性删除。假如你的过期 key，靠定期删除没有被删除掉，还停留在内存里，除非你的系统去查一下那个 key，才会被redis给删除掉。这就是所谓的惰性删除，即当你主动去查过期的key时,如果发现key过期了,就立即进行删除,不返回任何东西.

* 优点：节约CPU性能，发现必须删除的时候才删除
* 缺点：内存压力很大，出现长期占用内存的数据

> 总结：用存储空间换取处理器性能（随机抽查，重点抽查）

### 3 定期删除-内置功能

redis 会将每个设置了过期时间的 key 放入到一个独立的字典中，以后会定期遍历这个字典来删除到期的 key。

Redis 默认会每秒进行十次过期扫描（100ms一次），过期扫描不会遍历过期字典中所有的 key，而是采用了一种简单的贪心策略。

1. 从过期字典中随机 20 个 key。
2. 删除这 20 个 key 中已经过期的 key。
3. 如果过期的 key 比率超过 1/4，那就重复步骤 。

redis默认是每隔 100ms就随机抽取一些设置了过期时间的key，检查其是否过期，如果过期就删除。注意这里是随机抽取的。为什么要随机呢？你想一想假如 redis 存了几十万个 key ，每隔100ms就遍历所有的设置过期时间的 key 的话，就会给 CPU 带来很大的负载。

优点
* CPU性能占用设置有峰值，检测频度可自定义设置。

* 内存压力不是很大，长期占用内存的冷数据会被持续清理。

> 总结：周期性抽查存储空间

## 二、实际应用

实际应用场景Redis的过期删除策略就是：惰性删除+定期删除两种策略配合使用。


## Redis[脑裂](https://so.csdn.net/so/search?q=脑裂&spm=1001.2101.3001.7020)现象及解决方案

todo



### 应对脑裂
脑裂的主要原因其实就是哨兵集群认为主节点已经出现故障了，重新选举其它从节点作为主节点，而原主节点其实是假故障，从而导致短暂的出现两个主节点，那么在主从切换期间客户端一旦给原主节点发送命令，就会造成数据丢失。

所以应对脑裂的解决办法应该是去**限制原主库接收请求**，Redis提供了两个配置项。

- min-slaves-to-write：**从服务器数最小满足该值（最小从服务器数）**，否则主节点拒绝写入。

- min-slaves-max-lag：是指从库和主库进行数据复制时的 ACK 消息延迟的最大时间（**从连接的最大延迟时间**），否则主节点拒绝写入。


这两个配置项必须同时满足，不然主节点拒绝写入。

在假故障期间满足min-slaves-to-write和min-slaves-max-lag的要求，那么主节点就会被禁止写入，脑裂造成的数据丢失情况自然也就解决了。





总结
Redis脑裂可以采用min-slaves-to-write和min-slaves-max-lag合理配置尽量规避，但无法彻底解决，Redis脑裂最本质的问题是主从集群内部没有共识算法来维护多个节点的强一致性，它不像Zookeeper那样，每次写入必须大多数节点成功后才算成功，当脑裂发生时，Zookeeper节点被孤立，此时无法写入大多数节点，写请求会直接失败，因此Zookeeper才能保证集群的强一致性。
## 数据库高可用方案

## 一、基于配置中心实现主备切换
手动修改切换

## 二、基于keepalived实现主备切换

## 三、基于MHA实现主备切换
详见“MHA”章节

## 四、相关问题
### 1、从master宕机到slave接管成为新的master这段时间数据库是不可用的，如何避免这期间的数据丢失呢？
* 大部分情况下，数据都是先插入到缓存服务器再插入到数据库的，可以通过定时程序增量检查数据库与缓存数据是否一致，不一致则可以利用缓存数据对数据库实施补偿。

* 如果是消息队列落盘到数据库，如果操作数据库失败，则可以通过多次尝试来保证数据不丢失。

* 在流量不大的情况下，可以开启半同步复制功能：当事务提交到master后，master会等待slave的回应，待slave回应收到binglog后，master再响应请求已经完成事务。

* 利用mysql 5.6版本开始提供的GTID(全局事务ID)特性，由于新的master是之前的slave，而宕机后的master在重启后可以作为slave存在，可以依靠GTID特性来保证主备直接数据的最终一致性。


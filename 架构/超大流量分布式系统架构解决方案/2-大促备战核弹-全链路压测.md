## 大促备战核弹-全链路压测

就是在特定的业务场景下，将相关的链路完整的串联起来同时施压，尽可能的模拟出真实的用户行为。

## 一、为什么需要全链路压测
* 评估机器扩容数量
* 验证系统整体容量峰值
* 只有当系统整体负载处于较大压力时才会暴露
* 接口的短板效应只有在压测时才能发现

## 二、业务系统如何区分压测流量
### 1、压测流量打标
* 在URL上进行打标
* 在HTTP的header中进行打标

### 2、在链路上下文信息汇总传递压测标记
业界通用做法是在中间件，组件中升级改造支持。

### 3、外部第三方接口走Mock数据
避免直接与外部第三方接口(比如发短信服务)产生实际交互。

### 4、数据层如何区分
采用逻辑隔离方案
比如新建影子数据库存储压测数据，在DAL层优先选择在数据库的Proxy层上进行，通过改造分库分表中间类来解决路由问题。如果检测到是压测数据，则发好影子库的数据源。

## 三、如何发起大规模压测流量
作者采用阿里的Tatan.

### 1、数据构造
* Dump线上数据，经历脱敏，修正后导入数据池
* 负责将测试数据罗盘到影子库
* 根据目标场景导出相应的请求参数文件








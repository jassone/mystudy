## 抢红包

红包系统特点：事务安全和高并发

高并发高性能解决思路

- 高效存取：分布式缓存和本地缓存
- 缓冲：消息队列异步化
- 数据层横向扩展能力：分片

## 一、超卖方案

### 1、行悲观锁

select * ... for update

### 2、无符号字段+直接更新

数据库金额，数量字段设置为无符号类型，这样不会出现负数，如果出现了会报错。

### 3、乐观锁

先比较，再更新。适合写少和写冲突少的场景。where或update case

推荐用乐观锁+无符号字段：双重保险
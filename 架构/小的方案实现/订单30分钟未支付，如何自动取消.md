## 生成订单30分钟未支付，则自动取消，该怎么实现？

## 一、周期任务 + 数据库
将任务记录写入数据库，使用固定周期从数据库中加载延迟任务并执行，这是一种相对简单但暴力有效的实习思路。

### 1、优缺点
优点：
任务记录写入数据库，可防止进程崩溃引起的任务丢失。

缺点：
周期任务扫描，临界点任务可能到导致多延迟一个周期触发；
如果把周期设置的很低（比如1s），则会给数据库带来负担。

## 二、 时间轮算法
todo

## 三、redis
### 1、redis-zset
将订单超时时间戳与订单号分别设置为score和member，代码扫描元素判断是否超时。

### 2、redis-Keyspace Notifications
键空间机制，就是利用该机制可以在key失效之后，提供一个回调，实际上是redis会给客户端发送一个消息。是需要redis版本2.8以上。

### 3、优缺点
优点：
(1)由于使用Redis作为消息通道，消息都存储在Redis中。如果发送程序或者任务处理程序挂了，重启之后，还有重新处理数据的可能性。
(2)做集群扩展相当方便
(3)时间准确度高

缺点：
需要额外进行redis维护
 
## 四、使用消息队列
采用rabbitMQ的延时队列。

优点: 高效,可以利用rabbitmq的分布式特性轻易的进行横向扩展,消息支持持久化增加了可靠性。

缺点：本身的易用度要依赖于rabbitMq的运维.因为要引用rabbitMq,所以复杂度和成本变高。
 
 
 
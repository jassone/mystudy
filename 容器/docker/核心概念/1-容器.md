## 容器是什么

## 一、定义

容器技术是动态的容器、静态的镜像和远端的仓库这三者的组合。容器封装的货物是运行中的应用程序，也就是**进程**，同样它也会把进程与外界隔离开，让进程与外部系统互不影响。

**容器，就是一个特殊的隔离环境，它能够让进程只看到这个环境里的有限信息，不能对外界环境施加影响，即容器就是被隔离的进程**。

### 1、为什么需要隔离

在计算机世界里的隔离也是出于同样的考虑，也就是**系统安全**。

对于 Linux 操作系统来说，一个不受任何限制的应用程序是十分危险的。这个进程能够看到系统里所有的文件、所有的进程、所有的网络流量，访问内存里的任何数据，那么恶意程序很容易就会把系统搞瘫痪，正常程序也可能会因为无意的 Bug 导致信息泄漏或者其他安全事故。虽然 Linux 提供了用户权限控制，能够限制进程只访问某些资源，但这个机制还是比较薄弱的，和真正的“隔离”需求相差得很远。

而现在，**使用容器技术，我们就可以让应用程序运行在一个有严密防护的“沙盒”（Sandbox）环境之内**，从而保证了容器外系统的安全。

**容器技术的另一个本领就是为应用程序加上资源隔离，在系统里切分出一部分资源，让它只能使用指定的配额**，比如只能使用一个 CPU，只能使用 1GB 内存等等。这样就可以避免容器内进程的过度系统消耗，充分利用计算机硬件，让有限的资源能够提供稳定可靠的服务。

### 2、与虚拟机的区别是什么

![7bc16f6302.jpeg](https://pic1.imgdb.cn/item/6443f5cd0d2dde5777888a1d.webp)

Docker 官网的图（这张图示其实并不太准确，容器并不直接运行在 Docker 上，**Docker 只是辅助建立隔离环境，让容器基于 Linux 操作系统运行**）。

##### a) 相同点

- 容器和虚拟机的目的都是隔离资源，保证系统安全，然后是尽量提高资源的利用率。

##### b) 不同点

- 容器更轻

  从实现的角度来看，虚拟机虚拟化出来的是硬件，需要在上面再安装一个操作系统后才能够运行应用程序，而硬件虚拟化和操作系统都比较“重”，会消耗大量的 CPU、内存、硬盘等系统资源，但这些消耗其实并没有带来什么价值，属于“重复劳动”和“无用功”，不过好处就是隔离程度非常高，每个虚拟机之间可以做到完全无干扰。

  **容器直接利用了下层的计算机硬件和操作系统**，因为比虚拟机少了一层，所以自然就会节约 CPU 和内存，显得非常轻量级，能够更高效地利用硬件资源。不过，因为多个容器共用操作系统内核，应用程序的隔离程度就没有虚拟机那么高了。

- **容器运行效率高**

  容器运行效率，可以说是相比于虚拟机最大的优势。

|        | 实现方式                     | 优点                     | 缺点               |
| ------ | ---------------------------- | ------------------------ | ------------------ |
| 虚拟机 | 虚拟化硬件                   | 隔离程度高               | 资源消耗大，启动慢 |
| 容器   | 直接利用下层的硬件和操作系统 | 资源利用率高，运行速度快 | 隔离程度低         |

所以容器不是轻量级的虚拟机，**因为容器本质是一个进程，带着一组“隔离与限制”的进程**，与虚拟机差的太远了。

### 3、隔离是怎么实现的

使用了**namespace、cgroup、chroot**这三种技术。

namespace 是 2002 年从 Linux 2.4.19 开始出现的，和编程语言里的 namespace 有点类似，它可以创建出独立的文件系统、主机名、进程号、网络等资源空间，相当于给进程盖了一间小板房，这样就实现了系统全局资源和进程局部资源的隔离。

cgroup 是 2008 年从 Linux 2.6.24 开始出现的，它的全称是 Linux Control Group，用来实现对进程的 CPU、内存等资源的优先级和配额限制，相当于给进程的小板房加了一个天花板。

chroot 的历史则要比前面的 namespace、cgroup 要古老得多，早在 1979 年的 UNIX V7 就已经出现了，它可以更改进程的根目录，也就是限制访问文件系统，相当于给进程的小板房铺上了地砖。目前容器技术已经不用了，而是用pivot_root技术。
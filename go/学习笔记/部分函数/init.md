## init

init()函数(有点类似construct函数)会在**每个包完成初始化后自动执行**，并且执行优先级比main函数高。init 函数通常被用来：
* 设置初始表达式的值(对变量进行初始化)
* 检查/修复程序的状态
* 注册
* 实现sync.Once功能(运行一次计算)

## 一、包的初始化
为了使用导入的包，首先必须将其初始化。初始化总是以单线程执行，并且按照包的依赖关系顺序执行。这通过Golang的运行时系统控制，如下图所示：

![10118224-d98c52b0ab427646.webp](https://pic.imgdb.cn/item/622f53655baa1a80abe79dfa.png)

* 初始化导入的包（递归导入）
    初始化导入的包（包的初始化顺序并不是按导入顺序（“从上到下”）执行的，runtime需要解析包依赖关系，没有依赖的包最先初始化，与变量初始化依赖关系类似）；
* 对包块中声明的变量进行计算和分配初始值
    初始化包作用域的变量（该作用域的变量的初始化也并非按照“从上到下、从左到右”的顺序，runtime解析变量依赖关系，没有依赖的变量最先初始化）；
* 执行包中的init函数

> 即使包被导入多次，初始化只需要一次。

## 二、特性
* init函数不需要传入参数，也不会返回任何值。与main相比而言，init没有被声明，因此也不能被引用(调用)。
* 每个源文件可以包含多个init函数。每个包可以拥有多个init函数。
* 同一个包中多个init函数的执行顺序是没有明确定义的。？？todo
* 对同一个go文件的init()调用顺序是从上到下的。
* 对同一个package中不同文件是按文件名字符串比较“从小到大”顺序调用各文件中的init()函数。 todo
* 对于不同的package，如果不相互依赖的话，按照main包中"先import的后调用"的顺序调用其包中的init()todo。如果package存在依赖，则先调用最早被依赖的package中的init()，最后调用main函数。

* 如果init函数中使用了println()或者print()你会发现在执行过程中这两个不会按照你想象中的顺序执行。这两个函数官方只推荐在测试环境中使用，对于正式环境不要使用。

### 1、Go包导入规则的副作用
Go要求非常严格，不允许引用不使用的包。但是有时你引用包只是为了调用init函数去做一些初始化工作。此时空标识符（也就是下划线，`import _ " "`）的作用就是为了解决这个问题。

## 三、建议

- 少用init,main函数里手动初始化资源。

  因为如果init的资源panic后不好调试，且会阻塞。

 
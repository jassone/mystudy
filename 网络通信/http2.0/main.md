## http2.0
HTTP2并不是对HTTP协议的重写，相对于HTTP/1，HTTP/2的侧重点主要在性能。

## 一、基础知识

### 1、HTTP2中的一些概念
* 帧：数据通信的最小信息单位
* 流：**存在与TCP连接中的一个虚拟通道（双向的，能往过流，也能往回流）**

### 2、主要特性汇总

* HTTP/2支持HTTP/1.1的所有核心功能，但旨在通过多种方式提高效率
* HTTP/2采用**二进制传输数据**，而非HTTP/1的文本格式传输
* HTTP/2**基本协议单元是帧**，比如head（头部信息）帧,data（传输数据细信息）帧
* HTTP/2**使用双向流技术，支持多路复用**，也就是说提供了在单个连接上复用HTTP请求和响应的能力， 多个请求或响应可以同时在一个连接上使用流.
* HTTP/2**支持压缩头部帧**，允许将多个请求压缩成成一个分组,而且在客户端和服务器端分别头部信息建立索引，相同的表头只需要传输索引就可以。
* HTTP/2支持对请求划分优先级（就是流的优先级）
* HTTP / 2支持Server Push技术(服务器推送)

下面一张图来对比HTTP/1和HTTP/2的请求过程：


## 二、头部压缩
静态表+huffman编码压缩50%。
整体压缩比达到90%。

## 三、静态表

## 四、头部压缩-Huffman编码
* HTTP /1的请求头较大，而且是以纯文本发送，HTTP/2对消息头进行了压缩，采用的是HACK算法，能够节省消息头占用的网络流量，其主要是在两端建立了索引表，消息头在传输时可以采用索引，而HTTP/1.x每次请求，都会携带大量冗余头信息，浪费了很多带宽资源。
* HACK算法可以参考: https://www.zcfy.cc/article/1969

## 五、动态表

## 六、多路复用
* HTTP/2 将每一个请求变成流，每一个流都有自己的ID，有自己的优先级，这些流可以由客户端发送到服务端，也可以由服务端发送到客户端，将数据划分为帧，头部信息为head帧，实体信息为data帧，最后将这些流乱序发送到一个TCP连接中，如下图：
 ![pbj82jih5e.png](https://pic.imgdb.cn/item/62a5ad880947543129211860.png)

* HTTP/2中，在一个浏览器同域名下的所有请求都是在单个连接中完成，这个连接可以承载任意数量的双向数据流，每个数据流都以消息的形式发送，而消息又由一个或多个帧组成，多个帧之间可以乱序发送，根据帧首部的流标识可以将多个帧重新组装成一个流。
* 在HTTP/1中，如果想并发发送多个请求，必须创建多个TCP连接，而且浏览器为了减少负载，会对同一域名下的TCP连接做限制，这样当请求量比较大时，会引起阻塞，如下图，Stalled 阻塞已经达到159ms了.
  ![qgvqi21thp.jpeg](https://pic.imgdb.cn/item/62a5ada60947543129213df0.jpg)

## 七、服务器推送
* HTTP /1中客户端往服务端发送请求严格遵守一个请求，一个响应，比如客户端请求展示网页时，服务端发挥HTML内容，浏览器解析时发送css，js请求，服务端又返回css，js文件，那么服务端为什么不能在返回网页时就推送css，js内容给客户端呢，在HTTP /2中这已功能已经支持，
* 服务端主动推送也会遵守同源策略，不会随便推送第三方的资源到客户端
* 如果服务端推送资源是呗客户端缓存过的，客户端是有权力拒绝服务端的推送的，浏览器可以通过发送RST_STREAM帧来拒收。
* 每一个服务端推送的资源都是一个流

## todo

